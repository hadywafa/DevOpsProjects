Let‚Äôs simplify it ‚Äî no Sealed Secrets, just plain Kubernetes Secrets for now.

Below is the simplified version of the Redis + Argo CD setup using **generic Secrets** only (no encryption tools needed).

---

## üìÅ Repo layout

```ini
infra-repo/
  argocd/
    bootstrap/
      argocd-bootstrap-app.yaml
    apps/
      redis-dev.yaml
      redis-prod.yaml
    values/
      redis/
        dev.yaml
        prod.yaml
    secrets/
      dev/redis-auth.yaml
      prod/redis-auth.yaml
```

---

## 1Ô∏è‚É£ `argocd/bootstrap/argocd-bootstrap-app.yaml`

```yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: bootstrap
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-options: Prune=true,CreateNamespace=true
spec:
  destination:
    server: https://kubernetes.default.svc
    namespace: argocd
  source:
    repoURL: https://github.com/you/infra-repo.git
    targetRevision: main
    path: argocd/apps
    directory:
      recurse: true
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - ServerSideApply=true
```

---

## 2Ô∏è‚É£ `argocd/apps/redis-dev.yaml`

```yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: redis-dev
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "0"
spec:
  destination:
    server: https://kubernetes.default.svc
    namespace: orchida-tax-dev
  source:
    repoURL: https://charts.bitnami.com/bitnami
    chart: redis
    targetRevision: 19.5.0
    helm:
      valueFiles:
        - argocd/values/redis/dev.yaml
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
```

---

## 3Ô∏è‚É£ `argocd/apps/redis-prod.yaml`

```yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: redis-prod
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "0"
spec:
  destination:
    server: https://kubernetes.default.svc
    namespace: orchida-tax-prod
  source:
    repoURL: https://charts.bitnami.com/bitnami
    chart: redis
    targetRevision: 19.5.0
    helm:
      valueFiles:
        - argocd/values/redis/prod.yaml
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
```

---

## 4Ô∏è‚É£ `argocd/values/redis/dev.yaml`

```yaml
architecture: standalone

auth:
  enabled: true
  existingSecret: redis-auth
  existingSecretPasswordKey: redis-password

master:
  persistence:
    enabled: true
    size: 5Gi
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

networkPolicy:
  enabled: true
  allowExternal: false

service:
  type: ClusterIP
```

---

## 5Ô∏è‚É£ `argocd/values/redis/prod.yaml`

```yaml
architecture: replication

auth:
  enabled: true
  existingSecret: redis-auth
  existingSecretPasswordKey: redis-password

master:
  persistence:
    enabled: true
    size: 20Gi
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 1
      memory: 1Gi

replica:
  replicaCount: 2
  persistence:
    enabled: true
    size: 20Gi
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 1
      memory: 1Gi

sentinel:
  enabled: true
  resources:
    requests:
      cpu: 50m
      memory: 128Mi

networkPolicy:
  enabled: true
  allowExternal: false

service:
  type: ClusterIP
```

---

## 6Ô∏è‚É£ Generic Kubernetes Secrets

### `argocd/secrets/dev/redis-auth.yaml`

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: redis-auth
  namespace: orchida-tax-dev
type: Opaque
data:
  redis-password: ZGV2UGFzc3dvcmQh  # base64 of 'devPassword!'
```

### `argocd/secrets/prod/redis-auth.yaml`

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: redis-auth
  namespace: orchida-tax-prod
type: Opaque
data:
  redis-password: cHJvZFBhc3N3b3JkIQ==  # base64 of 'prodPassword!'
```

---

## üß† Why Secrets (and what are Sealed Secrets)?

* **Generic Secret:** a plain Kubernetes object storing credentials (base64-encoded, not encrypted). Easy for testing or internal setups.
* **SealedSecret (Bitnami):** an encrypted Secret ‚Äî safe to keep in Git. Argo CD decrypts it automatically when applying.
* In production GitOps, **SealedSecret** prevents exposing passwords in your repo.
* For now, using **generic Secrets** keeps it simple ‚Äî just don‚Äôt commit real passwords to Git.

---

## üöÄ How to bootstrap

1Ô∏è‚É£ Apply only the bootstrap manifest:

```bash
kubectl apply -n argocd -f argocd/bootstrap/argocd-bootstrap-app.yaml
```

2Ô∏è‚É£ Apply the Secret manifests before Argo CD syncs Redis:

```bash
kubectl apply -f argocd/secrets/dev/redis-auth.yaml
kubectl apply -f argocd/secrets/prod/redis-auth.yaml
```

3Ô∏è‚É£ Argo CD will detect and deploy Redis automatically for both environments.

---

‚úÖ After sync, test connectivity:

```bash
kubectl -n orchida-tax-dev exec -it $(kubectl -n orchida-tax-dev get pod -l app.kubernetes.io/name=redis -o jsonpath='{.items[0].metadata.name}') -- redis-cli -a devPassword! PING
```

Expected: `PONG`
